"use client"

import { useState, useEffect } from "react"
import { useTheme } from "@/contexts/theme-context"
import { Navbar } from "@/components/navbar"
import { Breadcrumb } from "@/components/breadcrumb"
import ChatWidget from "@/components/chat-widget"
import { ScrollToTop } from "@/components/scroll-to-top"
import { Lock, Shield, Zap, Target, CheckCircle, Code, Server, Cloud, Database, Network, FileText } from "lucide-react"
import { SharedFooter } from "@/components/shared-footer"

export default function PenetrationTestPage() {
  const { language: currentLang, theme: themeMode } = useTheme()
  const [activeAttackPhase, setActiveAttackPhase] = useState(0)
  const [highlightedService, setHighlightedService] = useState(0)

  // Global theme tokens (no hardcoded background/text/cards)
  const currentTheme = {
    background: "var(--page-bg)",
    text: "var(--page-fg)",
    accent: "var(--accent)",
    primary: "var(--primary)",
    secondary: "var(--secondary)",
    muted: "var(--muted)",
    mutedForeground: "var(--muted-foreground)",
    border: "var(--border)",
    cardBg: "var(--card-bg)",
    mode: themeMode,
  }

  const sharedFooterTheme = { bg: currentTheme.background, text: currentTheme.text, accent: currentTheme.accent }

  // Auto-cycle through attack phases
  useEffect(() => {
    const interval = setInterval(() => {
      setActiveAttackPhase((prev) => (prev + 1) % 6)
    }, 2000)
    return () => clearInterval(interval)
  }, [])

  // Auto-highlight services
  useEffect(() => {
    const interval = setInterval(() => {
      setHighlightedService((prev) => (prev + 1) % 8)
    }, 2800)
    return () => clearInterval(interval)
  }, [])

  // Animation colors ARE allowed (per your rule #1) — keep vivid cyber look
  const attackPhases = [
    { icon: Target, label: "Reconnaissance", labelAr: "استطلاع", color: "text-red-400", glow: "#ef4444" },
    { icon: Shield, label: "Scanning", labelAr: "الفحص", color: "text-orange-400", glow: "#fb923c" },
    { icon: Zap, label: "Exploitation", labelAr: "الاستغلال", color: "text-yellow-400", glow: "#facc15" },
    { icon: Lock, label: "Post-Exploitation", labelAr: "ما بعد الاستغلال", color: "text-green-400", glow: "#22c55e" },
    { icon: Network, label: "Lateral Movement", labelAr: "الحركة الجانبية", color: "text-blue-400", glow: "#60a5fa" },
    { icon: FileText, label: "Reporting", labelAr: "التقرير", color: "text-purple-400", glow: "#a855f7" },
  ]

  const services = [
    {
      icon: Server,
      title: "External Penetration Testing",
      titleAr: "اختبار الاختراق الخارجي",
      desc: "Simulated external attacks on perimeter",
      descAr: "محاكاة هجمات خارجية على المحيط",
    },
    {
      icon: Network,
      title: "Internal Penetration Testing",
      titleAr: "اختبار الاختراق الداخلي",
      desc: "Insider threat simulation",
      descAr: "محاكاة تهديدات داخلية",
    },
    {
      icon: Code,
      title: "Web Application PenTest",
      titleAr: "اختبار اختراق تطبيقات الويب",
      desc: "OWASP-based exploitation",
      descAr: "استغلال وفق منهجية OWASP",
    },
    {
      icon: Cloud,
      title: "Cloud Penetration Testing",
      titleAr: "اختبار اختراق السحابة",
      desc: "AWS, Azure, GCP security testing",
      descAr: "اختبار أمني لـ AWS، Azure، GCP",
    },
    {
      icon: Database,
      title: "Database Penetration Testing",
      titleAr: "اختبار اختراق قواعد البيانات",
      desc: "SQL injection & privilege escalation",
      descAr: "حقن SQL ورفع الصلاحيات",
    },
    {
      icon: Shield,
      title: "Active Directory PenTest",
      titleAr: "اختبار اختراق Active Directory",
      desc: "Kerberoasting & lateral movement",
      descAr: "هجمات Kerberos والحركة الجانبية",
    },
    {
      icon: Zap,
      title: "Red Team Operations",
      titleAr: "عمليات الفريق الأحمر",
      desc: "Full adversary simulation",
      descAr: "محاكاة كاملة للخصوم",
    },
    {
      icon: Lock,
      title: "Social Engineering Testing",
      titleAr: "اختبار الهندسة الاجتماعية",
      desc: "Phishing & credential harvesting",
      descAr: "التصيد وجمع بيانات الاعتماد",
    },
  ]

  return (
    <div
      className="min-h-screen"
      dir={currentLang === "ar" ? "rtl" : "ltr"}
      style={{
        background: `linear-gradient(to bottom right,
          var(--page-bg),
          color-mix(in srgb, var(--page-bg) 78%, var(--primary) 22%),
          color-mix(in srgb, var(--page-bg) 82%, var(--accent) 18%),
          var(--page-bg)
        )`,
        color: "var(--page-fg)",
      }}
    >
      <Navbar/>
            <Breadcrumb currentLang={currentLang} currentTheme={currentTheme} />
            <ChatWidget />
            <ScrollToTop />

      {/* Hero Section with Attack Chain Animation */}
      <section className="relative pt-32 pb-20 px-4 overflow-hidden">
        {/* Animated Background (keep vivid red/purple glows — allowed) */}
        <div className="absolute inset-0 opacity-15 pointer-events-none">
          <div
            className="absolute top-10 right-20 w-72 h-72 rounded-full blur-3xl animate-pulse"
            style={{ background: "radial-gradient(circle, rgba(239,68,68,0.85), transparent 70%)" }}
          ></div>
          <div
            className="absolute bottom-20 left-10 w-96 h-96 rounded-full blur-3xl animate-pulse"
            style={{
              background: "radial-gradient(circle, rgba(168,85,247,0.75), transparent 70%)",
              animationDelay: "1.5s",
            }}
          ></div>
        </div>

        <div className="max-w-7xl mx-auto relative z-10">
          <div className="grid lg:grid-cols-2 gap-12 items-center">
            {/* Left: Content */}
            <div className="space-y-6">
              <div
                className="inline-flex items-center gap-2 px-4 py-2 rounded-full border"
                style={{
                  background: "color-mix(in srgb, var(--card-bg) 55%, transparent)",
                  borderColor: "color-mix(in srgb, var(--border) 60%, transparent)",
                }}
              >
                <span className="text-sm font-semibold" style={{ color: "rgba(248,113,113,0.95)" }}>
                  {currentLang === "en" ? "⚡ Offensive Penetration Testing" : "⚡ اختبار الاختراق الهجومي"}
                </span>
              </div>

              <h1 className="text-5xl lg:text-6xl font-bold leading-tight" style={{ color: "var(--page-fg)" }}>
                {currentLang === "en" ? "Real-World Attack Simulation" : "محاكاة هجمات العالم الحقيقي"}
              </h1>

              <p className="text-xl leading-relaxed" style={{ color: "var(--muted-foreground)" }}>
                {currentLang === "en"
                  ? "Advanced penetration testing by offensive security experts using OSSTMM, PTES, OWASP, and MITRE ATT&CK methodologies to exploit vulnerabilities and test your defenses."
                  : "اختبار اختراق متقدم من خبراء الأمن الهجومي باستخدام منهجيات OSSTMM و PTES و OWASP و MITRE ATT&CK لاستغلال الثغرات واختبار دفاعاتك."}
              </p>

              <div className="flex flex-wrap gap-4 pt-4">
                <button
                  className="px-8 py-4 rounded-lg font-semibold transition-all hover:scale-105 shadow-lg"
                  style={{
                    background: "linear-gradient(90deg, rgba(239,68,68,1), rgba(168,85,247,1))",
                    boxShadow: "0 0 26px rgba(239,68,68,0.35)",
                    color: "white",
                  }}
                >
                  {currentLang === "en" ? "Schedule PenTest" : "جدولة اختبار الاختراق"}
                </button>

                <button
                  className="px-8 py-4 rounded-lg font-semibold transition-all hover:scale-105 border"
                  style={{
                    background: "color-mix(in srgb, var(--card-bg) 55%, transparent)",
                    borderColor: "color-mix(in srgb, var(--border) 60%, transparent)",
                    color: "var(--page-fg)",
                    backdropFilter: "blur(10px)",
                  }}
                >
                  {currentLang === "en" ? "View Attack Techniques" : "عرض تقنيات الهجوم"}
                </button>
              </div>
            </div>

            {/* Right: Animated Attack Chain */}
            <div className="relative h-[520px] flex items-center justify-center">
              <div className="relative w-full max-w-xl">
                {/* Make sure all vertical cards fit in view:
                    - On lg: two columns (3+3) to ensure no overflow
                    - On xl: single vertical column if space allows
                    - On small: 2x3 grid
                */}
                <div className="grid grid-cols-2 xl:grid-cols-1 lg:grid-cols-2 gap-4 xl:gap-5">
                  {attackPhases.map((phase, index) => {
                    const Icon = phase.icon
                    const isActive = index === activeAttackPhase

                    return (
                      <div key={index} className="relative">
                        <div
                          className="relative flex items-center gap-4 p-4 rounded-xl border backdrop-blur-sm transition-all duration-500"
                          style={{
                            background: isActive
                              ? "linear-gradient(90deg, rgba(239,68,68,0.16), rgba(168,85,247,0.14))"
                              : "color-mix(in srgb, var(--card-bg) 58%, transparent)",
                            borderColor: isActive
                              ? "rgba(239,68,68,0.45)"
                              : "color-mix(in srgb, var(--border) 60%, transparent)",
                            boxShadow: isActive ? `0 0 26px ${phase.glow}55` : "none",
                            transform: isActive ? "scale(1.03)" : "scale(1)",
                          }}
                        >
                          <div
                            className="w-14 h-14 rounded-full flex items-center justify-center transition-all duration-500"
                            style={{
                              background: isActive
                                ? `linear-gradient(135deg, ${phase.glow}, rgba(0,0,0,0.25))`
                                : "color-mix(in srgb, var(--card-bg) 50%, transparent)",
                              boxShadow: isActive ? `0 0 18px ${phase.glow}55` : "none",
                            }}
                          >
                            <Icon
                              className={`w-7 h-7 transition-all duration-500 ${isActive ? phase.color + " scale-110" : ""}`}
                              style={{ color: isActive ? undefined : "color-mix(in srgb, var(--page-fg) 55%, var(--primary) 45%)" }}
                            />
                          </div>

                          <div className="flex-1">
                            <h3
                              className="font-bold text-base sm:text-lg transition-all"
                              style={{ color: isActive ? "var(--page-fg)" : "color-mix(in srgb, var(--page-fg) 70%, var(--muted-foreground) 30%)" }}
                            >
                              {currentLang === "en" ? phase.label : phase.labelAr}
                            </h3>
                            {isActive && (
                              <div
                                className="h-1 w-full rounded-full mt-2"
                                style={{
                                  background: `linear-gradient(90deg, ${phase.glow}, rgba(168,85,247,0.9))`,
                                  animation: "ptPulse 1.2s ease-in-out infinite",
                                }}
                              />
                            )}
                          </div>

                          {isActive && (
                            <div
                              className="absolute -inset-1 rounded-xl border-2"
                              style={{
                                borderColor: "rgba(239,68,68,0.35)",
                                animation: "ptPing 1.35s ease-in-out infinite",
                              }}
                            ></div>
                          )}
                        </div>
                      </div>
                    )
                  })}
                </div>

                {/* Scientific connector vibe (subtle) */}
                <div
                  className="mt-5 rounded-2xl border p-4"
                  style={{
                    background: "color-mix(in srgb, var(--card-bg) 45%, transparent)",
                    borderColor: "color-mix(in srgb, var(--border) 55%, transparent)",
                  }}
                >
                  <p className="text-sm" style={{ color: "var(--muted-foreground)" }}>
                    {currentLang === "en"
                      ? "Attack chain dynamically highlights each phase to simulate real engagement flow."
                      : "سلسلة الهجوم تعرض تفعيل كل مرحلة بشكل ديناميكي لمحاكاة تدفق اختبار الاختراق الحقيقي."}
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      {/* Services Grid */}
      <section className="py-20 px-4">
        <div className="max-w-7xl mx-auto">
          <div className="text-center mb-16">
            <h2 className="text-4xl lg:text-5xl font-bold mb-6" style={{ color: "var(--page-fg)" }}>
              {currentLang === "en" ? "Penetration Testing Services" : "خدمات اختبار الاختراق"}
            </h2>
            <p className="text-xl max-w-3xl mx-auto" style={{ color: "var(--muted-foreground)" }}>
              {currentLang === "en"
                ? "Real offensive techniques used by expert hackers"
                : "تقنيات هجومية حقيقية يستخدمها خبراء الاختراق"}
            </p>
          </div>

          <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
            {services.map((service, index) => {
              const Icon = service.icon
              const isHighlighted = index === highlightedService

              return (
                <div
                  key={index}
                  className="group relative p-6 rounded-2xl border backdrop-blur-sm transition-all duration-500 hover:scale-105"
                  style={{
                    background: isHighlighted
                      ? "linear-gradient(135deg, rgba(239,68,68,0.14), rgba(168,85,247,0.12))"
                      : "color-mix(in srgb, var(--card-bg) 60%, transparent)",
                    borderColor: isHighlighted
                      ? "rgba(239,68,68,0.35)"
                      : "color-mix(in srgb, var(--border) 55%, transparent)",
                    boxShadow: isHighlighted ? "0 0 24px rgba(239,68,68,0.25)" : "none",
                  }}
                >
                  {/* Corner Accent */}
                  <div
                    className="absolute top-0 right-0 w-20 h-20 rounded-bl-3xl rounded-tr-2xl"
                    style={{
                      background: "linear-gradient(135deg, rgba(239,68,68,0.16), transparent)",
                    }}
                  ></div>

                  <div
                    className="w-16 h-16 rounded-xl flex items-center justify-center mb-4 transition-all duration-300"
                    style={{
                      background: isHighlighted
                        ? "linear-gradient(135deg, rgba(239,68,68,1), rgba(239,68,68,0.7))"
                        : "linear-gradient(135deg, rgba(239,68,68,0.14), rgba(168,85,247,0.10))",
                      transform: isHighlighted ? "scale(1.08)" : "scale(1)",
                    }}
                  >
                    <Icon className="w-8 h-8" style={{ color: "white" }} />
                  </div>

                  <h3 className="text-xl font-bold mb-3" style={{ color: "var(--page-fg)" }}>
                    {currentLang === "en" ? service.title : service.titleAr}
                  </h3>

                  <p className="leading-relaxed" style={{ color: "var(--muted-foreground)" }}>
                    {currentLang === "en" ? service.desc : service.descAr}
                  </p>

                  <div
                    className="absolute inset-0 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none"
                    style={{
                      background: "linear-gradient(90deg, rgba(239,68,68,0.08), rgba(168,85,247,0.06))",
                    }}
                  ></div>
                </div>
              )
            })}
          </div>
        </div>
      </section>

      {/* Tools & Methodologies */}
      <section
        className="py-20 px-4"
        style={{
          background: "linear-gradient(to bottom, transparent, color-mix(in srgb, var(--page-bg) 72%, var(--primary) 28%))",
        }}
      >
        <div className="max-w-7xl mx-auto">
          <div className="text-center mb-16">
            <h2 className="text-4xl lg:text-5xl font-bold mb-6" style={{ color: "var(--page-fg)" }}>
              {currentLang === "en" ? "Offensive Tools & Frameworks" : "أدوات وأطر العمل الهجومية"}
            </h2>
          </div>

          <div className="grid md:grid-cols-3 gap-8">
            {/* Methodologies */}
            <div
              className="p-8 rounded-2xl border backdrop-blur-sm hover:shadow-lg transition-all"
              style={{
                background: "color-mix(in srgb, var(--card-bg) 60%, transparent)",
                borderColor: "color-mix(in srgb, var(--border) 55%, transparent)",
              }}
            >
              <h3 className="text-2xl font-bold mb-6" style={{ color: "rgba(248,113,113,0.95)" }}>
                {currentLang === "en" ? "Methodologies" : "المنهجيات"}
              </h3>
              <ul className="space-y-3">
                {["OSSTMM", "PTES", "OWASP", "NIST SP 800-115", "MITRE ATT&CK"].map((item, i) => (
                  <li key={i} className="flex items-center gap-3">
                    <CheckCircle className="w-5 h-5" style={{ color: "rgba(248,113,113,0.95)" }} />
                    <span style={{ color: "color-mix(in srgb, var(--page-fg) 82%, var(--muted-foreground) 18%)" }}>{item}</span>
                  </li>
                ))}
              </ul>
            </div>

            {/* Tools */}
            <div
              className="p-8 rounded-2xl border backdrop-blur-sm hover:shadow-lg transition-all"
              style={{
                background: "color-mix(in srgb, var(--card-bg) 60%, transparent)",
                borderColor: "color-mix(in srgb, var(--border) 55%, transparent)",
              }}
            >
              <h3 className="text-2xl font-bold mb-6" style={{ color: "rgba(248,113,113,0.95)" }}>
                {currentLang === "en" ? "Offensive Tools" : "أدوات هجومية"}
              </h3>
              <ul className="space-y-3">
                {["Metasploit", "Burp Suite Pro", "BloodHound", "Mimikatz", "SQLmap"].map((item, i) => (
                  <li key={i} className="flex items-center gap-3">
                    <CheckCircle className="w-5 h-5" style={{ color: "rgba(248,113,113,0.95)" }} />
                    <span style={{ color: "color-mix(in srgb, var(--page-fg) 82%, var(--muted-foreground) 18%)" }}>{item}</span>
                  </li>
                ))}
              </ul>
            </div>

            {/* Deliverables */}
            <div
              className="p-8 rounded-2xl border backdrop-blur-sm hover:shadow-lg transition-all"
              style={{
                background: "color-mix(in srgb, var(--card-bg) 60%, transparent)",
                borderColor: "color-mix(in srgb, var(--border) 55%, transparent)",
              }}
            >
              <h3 className="text-2xl font-bold mb-6" style={{ color: "rgba(248,113,113,0.95)" }}>
                {currentLang === "en" ? "Deliverables" : "المخرجات"}
              </h3>
              <ul className="space-y-3">
                {[
                  currentLang === "en" ? "Technical Report" : "تقرير تقني",
                  currentLang === "en" ? "Executive Summary" : "ملخص تنفيذي",
                  currentLang === "en" ? "PoC Exploits" : "إثباتات المفهوم",
                  currentLang === "en" ? "Attack Paths" : "مسارات الهجوم",
                  currentLang === "en" ? "Retest Report" : "تقرير إعادة الاختبار",
                ].map((item, i) => (
                  <li key={i} className="flex items-center gap-3">
                    <CheckCircle className="w-5 h-5" style={{ color: "rgba(248,113,113,0.95)" }} />
                    <span style={{ color: "color-mix(in srgb, var(--page-fg) 82%, var(--muted-foreground) 18%)" }}>{item}</span>
                  </li>
                ))}
              </ul>
            </div>
          </div>
        </div>
      </section>

      {/* CTA Section */}
      <section className="py-20 px-4">
        <div className="max-w-4xl mx-auto text-center">
          <div
            className="p-12 rounded-3xl border backdrop-blur-sm"
            style={{
              background: "linear-gradient(135deg, rgba(239,68,68,0.14), rgba(168,85,247,0.10))",
              borderColor: "color-mix(in srgb, var(--border) 60%, transparent)",
            }}
          >
            <Zap className="w-16 h-16 mx-auto mb-6" style={{ color: "rgba(248,113,113,0.95)" }} />
            <h2 className="text-4xl font-bold mb-6" style={{ color: "var(--page-fg)" }}>
              {currentLang === "en" ? "Ready to Test Your Security?" : "مستعد لاختبار أمانك؟"}
            </h2>
            <p className="text-xl mb-8 max-w-2xl mx-auto" style={{ color: "var(--muted-foreground)" }}>
              {currentLang === "en"
                ? "Challenge your defenses with real-world penetration testing"
                : "تحدى دفاعاتك باختبار اختراق العالم الحقيقي"}
            </p>
            <button
              className="px-10 py-5 rounded-xl font-bold text-lg transition-all hover:scale-105 shadow-2xl"
              style={{
                background: "linear-gradient(90deg, rgba(239,68,68,1), rgba(168,85,247,1))",
                boxShadow: "0 0 30px rgba(239,68,68,0.35)",
                color: "white",
              }}
            >
              {currentLang === "en" ? "Request PenTest" : "طلب اختبار اختراق"}
            </button>
          </div>
        </div>
      </section>

      <SharedFooter  />
      <ChatWidget />
      <ScrollToTop />

      <style jsx global>{`
        @keyframes ptPulse {
          0% { opacity: 0.45; transform: scaleX(0.85); }
          50% { opacity: 1; transform: scaleX(1); }
          100% { opacity: 0.45; transform: scaleX(0.85); }
        }
        @keyframes ptPing {
          0% { opacity: 0.0; transform: scale(0.96); }
          30% { opacity: 0.55; transform: scale(1.01); }
          100% { opacity: 0.0; transform: scale(1.06); }
        }
      `}</style>
    </div>
  )
}
